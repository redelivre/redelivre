<DirectoryMatch "/uploads/">
	Options -Indexes
	Options -ExecCGI
	AddHandler text/plain .php .php3 .php4 .phtml .pl .py .jsp .asp .htm .shtml .sh .cgi .js .php5 .exe .com
</DirectoryMatch>
<DirectoryMatch "/plugins/">
	Options -Indexes
</DirectoryMatch>
<FilesMatch ^wp-config.php$ >
	Order allow,deny
	Deny from all
</FilesMatch>
<FilesMatch ^readme.html$ >
	Order allow,deny
	Deny from all
</FilesMatch>
<FilesMatch ^install.php$ >
	AuthType Basic
        AuthName "WP Upgrade Security Layer"
        AuthUserFile /etc/apache2/wpupgrade.passwd
        require  valid-user
</FilesMatch>
<FilesMatch ^upgrade.php$ >
	AuthType Basic
        AuthName "WP Upgrade Security Layer"
        AuthUserFile /etc/apache2/wpupgrade.passwd
        require  valid-user
</FilesMatch>
#<FilesMatch ^swfupload.swf$ >
#	Order allow,deny
#        Deny from all
#</FilesMatch>
#<FilesMatch ^install.php$ >
#	Order deny,allow
#	Deny from all
#	Allow from localhost
#</FilesMatch>

#<DirectoryMatch "/wp-admin/includes/" >
#	Order deny,allow
#	Deny from all
#</DirectoryMatch>
<DirectoryMatch "/wp-includes/" >
#	Order deny,allow
#	Deny from all
	Options -Indexes
</DirectoryMatch>
#<DirectoryMatch "/wp-includes/js/tinymce/langs/" >
#	Options -Indexes
#        Options -ExecCGI
#        AddHandler cgi-script .php .php3 .php4 .phtml .pl .py .jsp .asp .htm .shtml .sh .cgi .js .php5 .exe .com
#</DirectoryMatch>
#<DirectoryMatch "/wp-includes/theme-compat/" >
#	Order deny,allow
#	Deny from all
#</DirectoryMatch>
<IfModule mod_headers.c>
	Header unset X-Powered-By
	Header unset Server
</IfModule>

<DirectoryMatch "/wp-includes/" >
	RewriteEngine On
	RewriteCond %{QUERY_STRING} buttonImageURL [OR]
	RewriteCond %{QUERY_STRING} ButtonText [OR]
	RewriteCond %{QUERY_STRING} movieName
	RewriteRule .* index.php [F]
</DirectoryMatch>
<FilesMatch ^xmlrpc.php$ >
	Order allow,deny
	Deny from all
</FilesMatch>
<FilesMatch ^wpad.dat$ >
	Order allow,deny
	Deny from all
</FilesMatch>
<FilesMatch ^wp-db.php$ >
	php_value max_execution_time 3000
	php_value max_input_time 3000
	php_value memory_limit 1024M
</FilesMatch>
<FilesMatch ^export.php$ >
	php_value max_execution_time 3000
	php_value max_input_time 3000
	php_value memory_limit 1024M
</FilesMatch>
<FilesMatch ^formatting.php$ >
	php_value max_execution_time 3000
	php_value max_input_time 3000
</FilesMatch>
<FilesMatch ^kses.php$ >
	php_value max_execution_time 3000
	php_value max_input_time 3000
</FilesMatch>
<FilesMatch ^meta.php$ >
	php_value max_execution_time 3000
	php_value max_input_time 3000
	php_value memory_limit 512M
</FilesMatch>
<FilesMatch ^wp-includes/Requests/Transport/cURL.php$ >
	php_value max_execution_time 3000
	php_value max_input_time 3000
	php_value memory_limit 1024M
</FilesMatch>
<LocationMatch "^/wp-admin/admin.php">
  <If "%{QUERY_STRING} =~ /.*import=.*/" >
	php_value max_execution_time 3000
        php_value max_input_time 3000
        php_value memory_limit 1024M	
  </If>
</LocationMatch>
<IfModule mod_security2.c>
	SecAction phase:1,nolog,pass,initcol:ip=%{REMOTE_ADDR},initcol:user=%{REMOTE_ADDR},id:5000134
	<Locationmatch "/wp-login.php">
		# Setup brute force detection.
		# React if block flag has been set.
		SecRule user:bf_block "@gt 0" "deny,status:401,log,id:5000135,msg:'ip address blocked for 5 minutes, more than 10 login attempts in 3 minutes.'"
		# Setup Tracking. On a successful login, a 302 redirect is performed, a 200 indicates login failed.
		SecRule RESPONSE_STATUS "^302" "phase:5,t:none,nolog,pass,setvar:ip.bf_counter=0,id:5000136"
		SecRule RESPONSE_STATUS "^200" "phase:5,chain,t:none,nolog,pass,setvar:ip.bf_counter=+1,deprecatevar:ip.bf_counter=1/180,id:5000137"
		SecRule ip:bf_counter "@gt 5" "t:none,setvar:user.bf_block=1,expirevar:user.bf_block=300,setvar:ip.bf_counter=0"
	</locationmatch>
	SecUploadDir /tmp
	SecUploadKeepFiles Off
	#Prevent post errors
	<locationmatch "/wp-comments-post.php">
		SecRuleRemoveById 300013
		SecRuleRemoveById 300015
		SecRuleRemoveById 300016
		SecRuleRemoveById 300017
	</locationmatch>
	<locationmatch "/wp-admin/post.php">
		SecRuleRemoveById 300013
		SecRuleRemoveById 300015
		SecRuleRemoveById 300016
		SecRuleRemoveById 300017
	</locationmatch>
	<locationmatch "/wp-admin/admin-ajax.php">
		SecRuleRemoveById 941100
		SecRuleRemoveById 949110
		SecRuleRemoveById 980130
		SecRuleRemoveById 942100
	</locationmatch>
</IfModule>
#<FilesMatch "load-scripts\.php|load-styles\.php">
#  Order allow,deny
#  Deny from all
#</FilesMatch>
<IfModule mod_evasive20.c>
	DOSWhitelist 173.245.48.0
	DOSWhitelist 103.21.244.0
	DOSWhitelist 103.22.200.0
	DOSWhitelist 103.31.4.0
	DOSWhitelist 141.101.64.0
	DOSWhitelist 108.162.192.0
	DOSWhitelist 190.93.240.0
	DOSWhitelist 188.114.96.0
	DOSWhitelist 197.234.240.0
	DOSWhitelist 198.41.128.0
	DOSWhitelist 162.158.0.0
	DOSWhitelist 104.16.0.0
	DOSWhitelist 172.64.0.0
	DOSWhitelist 131.0.72.0
</IfModule>
<IfModule mod_rewrite.c>
	RewriteEngine On

	## Automated HTTP libraries
	RewriteCond %{HTTP_USER_AGENT} ^.*(dav.pm/v|libwww-perl|urllib|python-requests|python-httplib2|winhttp.winhttprequest|lwp-request|lwp-trivial|fasthttp|Go-http-client|Java|httplib|httpclient|Zend_Http_Client).*$ [NC]
	RewriteRule .* - [F,L]

	## Commonly seen in DDoS attacks
	RewriteCond %{HTTP_USER_AGENT} ^.*(CtrlFunc|w00tw00t|Apachebench).*$ [NC]
	RewriteRule .* - [F,L]
	## There is no user agent at all
	RewriteCond %{HTTP_USER_AGENT} ^\s*$
	RewriteRule .* - [F,L]
 
	## There is no host header
	RewriteCond %{HTTP_HOST} ^$
	RewriteRule .* - [F,L]
	
	## And if we're POST to these pages (i.e. clicking a submit button) we should have a referer, too.
	RewriteCond %{THE_REQUEST} ^.*wp-login [OR]
	RewriteCond %{THE_REQUEST} ^.*wp-comment
	RewriteCond %{REQUEST_METHOD} POST
	RewriteCond %{HTTP_REFERER} ^$
	RewriteRule .* - [F,L]

	## Bad Robots
	RewriteCond %{HTTP_USER_AGENT} ^BlackWidow [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Bot\ mailto:craftbot@yahoo.com [OR]
	RewriteCond %{HTTP_USER_AGENT} ^ChinaClaw [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Custo [OR]
	RewriteCond %{HTTP_USER_AGENT} ^DISCo [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Download\ Demon [OR]
	RewriteCond %{HTTP_USER_AGENT} ^eCatch [OR]
	RewriteCond %{HTTP_USER_AGENT} ^EirGrabber [OR]
	RewriteCond %{HTTP_USER_AGENT} ^EmailSiphon [OR]
	RewriteCond %{HTTP_USER_AGENT} ^EmailWolf [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Express\ WebPictures [OR]
	RewriteCond %{HTTP_USER_AGENT} ^ExtractorPro [OR]
	RewriteCond %{HTTP_USER_AGENT} ^EyeNetIE [OR]
	RewriteCond %{HTTP_USER_AGENT} ^FlashGet [OR]
	RewriteCond %{HTTP_USER_AGENT} ^GetRight [OR]
	RewriteCond %{HTTP_USER_AGENT} ^GetWeb! [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Go!Zilla [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Go-Ahead-Got-It [OR]
	RewriteCond %{HTTP_USER_AGENT} ^GrabNet [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Grafula [OR]
	RewriteCond %{HTTP_USER_AGENT} ^HMView [OR]
	RewriteCond %{HTTP_USER_AGENT} HTTrack [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} ^Image\ Stripper [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Image\ Sucker [OR]
	RewriteCond %{HTTP_USER_AGENT} Indy\ Library [NC,OR]
	RewriteCond %{HTTP_USER_AGENT} ^InterGET [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Internet\ Ninja [OR]
	RewriteCond %{HTTP_USER_AGENT} ^JetCar [OR]
	RewriteCond %{HTTP_USER_AGENT} ^JOC\ Web\ Spider [OR]
	RewriteCond %{HTTP_USER_AGENT} ^larbin [OR]
	RewriteCond %{HTTP_USER_AGENT} ^LeechFTP [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Mass\ Downloader [OR]
	RewriteCond %{HTTP_USER_AGENT} ^MIDown\ tool [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Mister\ PiX [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Navroad [OR]
	RewriteCond %{HTTP_USER_AGENT} ^NearSite [OR]
	RewriteCond %{HTTP_USER_AGENT} ^NetAnts [OR]
	RewriteCond %{HTTP_USER_AGENT} ^NetSpider [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Net\ Vampire [OR]
	RewriteCond %{HTTP_USER_AGENT} ^NetZIP [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Octopus [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Offline\ Explorer [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Offline\ Navigator [OR]
	RewriteCond %{HTTP_USER_AGENT} ^PageGrabber [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Papa\ Foto [OR]
	RewriteCond %{HTTP_USER_AGENT} ^pavuk [OR]
	RewriteCond %{HTTP_USER_AGENT} ^pcBrowser [OR]
	RewriteCond %{HTTP_USER_AGENT} ^RealDownload [OR]
	RewriteCond %{HTTP_USER_AGENT} ^ReGet [OR]
	RewriteCond %{HTTP_USER_AGENT} ^SiteSnagger [OR]
	RewriteCond %{HTTP_USER_AGENT} ^SmartDownload [OR]
	RewriteCond %{HTTP_USER_AGENT} ^SuperBot [OR]
	RewriteCond %{HTTP_USER_AGENT} ^SuperHTTP [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Surfbot [OR]
	RewriteCond %{HTTP_USER_AGENT} ^tAkeOut [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Teleport\ Pro [OR]
	RewriteCond %{HTTP_USER_AGENT} ^VoidEYE [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Web\ Image\ Collector [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Web\ Sucker [OR]
	RewriteCond %{HTTP_USER_AGENT} ^WebAuto [OR]
	RewriteCond %{HTTP_USER_AGENT} ^WebCopier [OR]
	RewriteCond %{HTTP_USER_AGENT} ^WebFetch [OR]
	RewriteCond %{HTTP_USER_AGENT} ^WebGo\ IS [OR]
	RewriteCond %{HTTP_USER_AGENT} ^WebLeacher [OR]
	RewriteCond %{HTTP_USER_AGENT} ^WebReaper [OR]
	RewriteCond %{HTTP_USER_AGENT} ^WebSauger [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Website\ eXtractor [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Website\ Quester [OR]
	RewriteCond %{HTTP_USER_AGENT} ^WebStripper [OR]
	RewriteCond %{HTTP_USER_AGENT} ^WebWhacker [OR]
	RewriteCond %{HTTP_USER_AGENT} ^WebZIP [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Wget [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Widow [OR]
	RewriteCond %{HTTP_USER_AGENT} ^WWWOFFLE [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Xaldon\ WebSpider [OR]
	RewriteCond %{HTTP_USER_AGENT} ^Zeus
	RewriteRule ^.* - [F,L]
</IfModule>
