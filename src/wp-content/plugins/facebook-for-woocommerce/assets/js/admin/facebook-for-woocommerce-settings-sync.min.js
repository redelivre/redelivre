"use strict";jQuery(document).ready(function(a){function n(e){a(".product-sync-field").each(function(){var o=a(this);a(this).hasClass("wc-enhanced-select")&&(o=a(this).next("span.select2-container")),e?o.css("pointer-events","all").css("opacity","1.0"):o.css("pointer-events","none").css("opacity","0.4")})}a(".woocommerce-help-tip").tipTip({attribute:"data-tip",fadeIn:50,fadeOut:50,delay:200}),a("form.wc-facebook-settings").hasClass("disconnected")&&n(!1),a("input#wc_facebook_enable_product_sync").on("change",function(o){a("form.wc-facebook-settings").hasClass("disconnected")?a(this).css("pointer-events","none").css("opacity","0.4"):n(a(this).is(":checked"))}).trigger("change");var i=!1;function e(o){s(0<arguments.length&&void 0!==o?o:null),window.syncStatusInterval||(window.syncStatusInterval=setInterval(_,1e4))}function s(o){var e=0<arguments.length&&void 0!==o?o:null;n(!1),a('input#wc_facebook_enable_product_sync, input[name="save_product_sync_settings"]').css("pointer-events","none").css("opacity","0.4");var c=facebook_for_woocommerce_settings_sync.i18n.sync_in_progress;e&&(c=(c+=1<e?facebook_for_woocommerce_settings_sync.i18n.sync_remaining_items_plural:facebook_for_woocommerce_settings_sync.i18n.sync_remaining_items_singular).replace("{count}",e)),a("#sync_progress").show().html(c).css("color","inherit"),facebook_for_woocommerce_settings_sync.sync_in_progress=!0}function t(o){var e=0<arguments.length&&void 0!==o?o:"";facebook_for_woocommerce_settings_sync.sync_in_progress=!1,clearInterval(window.syncStatusInterval),n(!(window.syncStatusInterval=null)),a('input#wc_facebook_enable_product_sync, input[name="save_product_sync_settings"]').css("pointer-events","all").css("opacity","1"),e?a("#sync_progress").show().html(e).css("color","#DC3232"):a("#sync_progress").hide()}function _(){facebook_for_woocommerce_settings_sync.sync_in_progress&&a.post(facebook_for_woocommerce_settings_sync.ajax_url,{action:"wc_facebook_get_sync_status",nonce:facebook_for_woocommerce_settings_sync.sync_status_nonce},function(o){console.log(o),o.success&&(0<o.data?e(o.data):t())})}a('input[name="save_product_sync_settings"]').on("click",function(o){if(i)return!0;o.preventDefault();var e,c,n,s,t=a(this),_=(n=a("#wc_facebook_excluded_product_category_ids").val(),s=[],window.facebook_for_woocommerce_settings_sync&&window.facebook_for_woocommerce_settings_sync.excluded_category_ids&&(s=window.facebook_for_woocommerce_settings_sync.excluded_category_ids),a(n).not(s).get()),r=(e=a("#wc_facebook_excluded_product_tag_ids").val(),c=[],window.facebook_for_woocommerce_settings_sync&&window.facebook_for_woocommerce_settings_sync.excluded_tag_ids&&(c=window.facebook_for_woocommerce_settings_sync.excluded_tag_ids),a(e).not(c).get());0<_.length||0<r.length?a.post(facebook_for_woocommerce_settings_sync.ajax_url,{action:"facebook_for_woocommerce_set_excluded_terms_prompt",security:facebook_for_woocommerce_settings_sync.set_excluded_terms_prompt_nonce,categories:_,tags:r},function(o){o&&!o.success?(a("#wc-backbone-modal-dialog .modal-close").trigger("click"),new a.WCBackboneModal.View({target:"facebook-for-woocommerce-modal",string:o.data}),a(".facebook-for-woocommerce-confirm-settings-change").on("click",function(){blockModal(),i=!0,t.trigger("click")})):(i=!0,t.trigger("click"))}):(i=!0,t.trigger("click"))}),facebook_for_woocommerce_settings_sync.sync_in_progress&&e(),a("#woocommerce-facebook-settings-sync-products").click(function(o){if(o.preventDefault(),confirm(facebook_for_woocommerce_settings_sync.i18n.confirm_sync)){s();var c=Date.now();a.post(facebook_for_woocommerce_settings_sync.ajax_url,{action:"wc_facebook_sync_products",nonce:facebook_for_woocommerce_settings_sync.sync_products_nonce},function(o){if(console.log(o),o.success)setTimeout(_,Math.max(0,1e4-(Date.now()-c)));else{var e=facebook_for_woocommerce_settings_sync.i18n.general_error;o.data&&0<o.data.length&&(e=o.data),t(e)}}).fail(function(){t(facebook_for_woocommerce_settings_sync.i18n.general_error)})}})});